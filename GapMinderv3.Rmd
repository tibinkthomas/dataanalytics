---
title: "Gap Minder Analysis"
author: "Tibin Thomas"
date: "2/17/2019"
output:
  html_document: default
  pdf_document: default
  word_document: default
---


----------------

### Objective

The goal of this project is to analyze gapminder dataset by exploring the data, visualizing the data and reporting the findings in a precise and concise format. 


```{r,echo=FALSE,warning=FALSE}
library(readxl)
gapmind <- read.csv("C:/Users/tthomas/OneDrive/Academics/MS in Analytics/ANLY506ExploratoryDataAnaly/FinalProject/dataanalytics/Data/gapminder.csv")
View(gapmind)
library(ggplot2)
library(RColorBrewer)
library(GGally)
library(reshape2)
library(ggpubr)
library(plyr)
library(dplyr)
library(magrittr)
library(ggplot2)
library(tidyr)
library(data.table)
library(markdown)
library(twang)
library(factoextra)
library(nycflights13)
library(lubridate)
library(matrixStats)
```

### Overview

To get an overview of the data, let's shake the data like a little gift box we received. Let's use some R functions to obtain glances at the daya. 

```{r, echo=FALSE, warning=FALSE}
class(gapmind)# To see what class the object is
names(gapmind)# To see  
```

The data.frame object has 6 variables, Country, Year, Life, Population, Income and region. 
Let us analyze the object to see what the datatypes are for the object. 

```{r, echo=FALSE, warning=FALSE}
str(gapmind)#Detailed summary of structure of data
head(gapmind)# First few rows of data
unique(gapmind$Country)
unique(gapmind$Year)
unique(gapmind$region)
```

There are 41284 data points.The dataset has 197 countries and for each of the 197 unique countries and 6 regions namely South Asia, Europe & Central Asia, Middle East & North Africa, Sub-Saharan Africa, America and East Asia & Pacific, the data provides values for Life, Population and Income for 41284 observations. The data spans from year 1800 to year 2015.

NExt step is to see what the data really is. Let's get a summary for the data.

```{r, echo=FALSE, warning=FALSE}
summary(gapmind)# To see the quantitive summary of the data
```

The summary shows us a lot of takeaways but one the most striking one for me is that there are a lot of NAs in the dataset. We need to remember to take that in to consideration while analyzig the data. Let's dive more into the data. 

***

## Univariate Analysis

Now that we have a general idea about the data, let us see the summary of each variables by groups to get a better feel for the data. Then let us look at the distribution to see how the counts are. 

<!-- Let's plot the distribution of each of the variable as I would like to get a feel of the variables first. Based on the distribution shape, i.e. Normal, Positive Skew or Negative Skew and amount of outliers present into them, this will also help us to get some sense what to expect when I plot different variables against each other.-->

### Life

Let's check life spread and summary 

```{r,echo=FALSE,warning=FALSE}
arrange(gapmind, life)
arrange(gapmind, desc(life)) 
View(gapmind %>% # Compute groupwise and show the table
 group_by(region) %>%
 summarize(mean(life),
 median(life)))
gapmind %>% # For each region
 group_by(region) %>%
 summarize("StandardDeviation" = sd(life),
 "InterQuartileRange" = IQR(life),
 "Number" = n())
```

<!--Much more disparate but we have a nice peak around 9.5% by volume. All in all it still looks like a normal distribution, slight skewed towards left.-->

It looks like the lowest life expectancy is for Fiji with 1 year for the year 1875. Andora for year 2015 has the highest life expectancy at 84.1 years. The table shows the mean and median of life expectancy for the 5 regions and Europe & Central Asia has the highest mean and median life expectancy at 48.79419 and 41.74110 and the gighest standard deviation and IQR at 17.09 and 31.   

Next let's look at the distribution,
```{r,echo=FALSE,warning=FALSE}
ggplot(gapmind) + geom_boxplot(aes(x = region, y = life))
a <- ggplot(gapmind, aes(x = life))
a + geom_density() +
  geom_vline(aes(xintercept = mean(life)), 
             linetype = "dashed", size = 0.6)
a + geom_density(aes(y = ..count..), fill = "lightgray") +
  geom_vline(aes(xintercept = mean(life)), 
             linetype = "dashed", size = 0.6,
             color = "#FC4E07")
```
### Population

Let's check population spread and summary

```{r,echo=FALSE,warning=FALSE}
gapmind %>% # For each region
 group_by(region) %>%
 summarize("StandardDeviation" = sd(population),
 "InterQuartileRange" = IQR(population),
 "Number" = n())
```
<!--```{r,echo=FALSE,warning=FALSE}
ggplot(gapmind) + geom_boxplot(aes(x = region, y = population))
a <- ggplot(gapmind, aes(x = population))
a + geom_density() +
  geom_vline(aes(xintercept = mean(population)), 
             linetype = "dashed", size = 0.6)
a + geom_density(aes(y = ..count..), fill = "lightgray") +
  geom_vline(aes(xintercept = mean(population)), 
             linetype = "dashed", size = 0.6,
             color = "#FC4E07")
```-->

### Income

Next let us look at Income,    
```{r,echo=FALSE,warning=FALSE}
arrange(gapmind, income)
arrange(gapmind, desc(income)) 
View(gapmind %>% # Compute groupwise and show the table
 group_by(region) %>%
 summarize(mean(income, na.rm=TRUE),
 median(income, na.rm=TRUE)))
gapmind %>% # For each region
 group_by(region) %>%
 summarize("StandardDeviation" = sd(income, na.rm=TRUE),
 "InterQuartileRange" = IQR(income, na.rm=TRUE),
 "Number" = n())
```

It looks like the lowest income reported was for the country Liberia in Sub-Suharan Africa for the year 1995. The highest income recorded was for Country United Arab Emirates in Middle East & North Africa for the year 1980. Highest mean income was for Middle East & North Africa at 8064.382 while the lowest was for South Asia at 1384.976. Lowest median income was sub saharan Africa at 827 while the highest median was for Europe & Central Asia at 2735. 

```{r,echo=FALSE,warning=FALSE}
ggplot(gapmind) + geom_boxplot(aes(x = region, y = income))
a <- ggplot(gapmind, aes(x = income))
a + geom_density() +
  geom_vline(aes(xintercept = mean(income)), 
             linetype = "dashed", size = 0.6)
a + geom_density(aes(y = ..count..), fill = "lightgray") +
  geom_vline(aes(xintercept = mean(income)), 
             linetype = "dashed", size = 0.6,
             color = "#FC4E07")
```

The above graph tells us that the distriubtoin is skewed. The distributoin has a very small number of large values and a very large number of small values. 


<!--It looks like a normal distribution. Most of the wines quality are around 5/6/7. As the good quality and the poor quality wines are almost like outliers here, it might be difficult to get an accurate model of the Wine Quality. Let's look at the other plots.-->

***


##Bivariate  analysis

Next, let us look at the bivariate analysis. First let us look at income and life  

### Income and Life

```{r,echo=FALSE,warning=FALSE}
p <- ggplot(filter(gapmind),
            aes(x = income, y = life)) # just initializes
p <- p + scale_x_log10() # log the x axis the right way
p + geom_point() # scatterplot
p + geom_point(aes(color = region)) # map continent to color
p + geom_point(alpha = (1/3), size = 3) + geom_smooth(lwd = 3, se = FALSE)
p + geom_point(alpha = (1/3), size = 3) + facet_wrap(~ region) +
  geom_smooth(lwd = 1.5, se = FALSE)
```

To check if the income levels affect life generally, we plot income vs life and conduct a correlation test. 

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x = income, y = life), data = gapmind) +
  geom_jitter(alpha = 0.5, size = 0.2) +
  geom_boxplot(outlier.colour= 'red', alpha = 0.5, color = 'blue') +
  ggtitle("Income vs life")
cor(gapmind$life, gapmind$income, use = 'pairwise')
```

There is a correlation of 0.58 between income and life which is evidence that these two are correalated.We can observe from the graph that the higher the income, the higher the life. This is very much true for America. 

***
### Year and Life 

```{r,echo=FALSE,warning=FALSE}
p <- ggplot(filter(gapmind),
            aes(x = Year, y = life)) # just initializes
p <- p + scale_x_log10() # log the x axis the right way
p + geom_point() # scatterplot
p + geom_point(aes(color = region)) # map continent to color
p + geom_point(alpha = (1/3), size = 3) + geom_smooth(lwd = 3, se = FALSE)
p + geom_point(alpha = (1/3), size = 3) + facet_wrap(~ region) +
  geom_smooth(lwd = 1.5, se = FALSE)
```

To check if the life generally increases or decreases as the time progress, we plot year vs life and conduct a correlation test. 

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x = Year, y = life), data = gapmind) +
  geom_jitter(alpha = 0.5, size = 0.2) +
  geom_boxplot(outlier.colour= 'red', alpha = 0.5, color = 'blue') +
  ggtitle("Year VS Life")
cor(gapmind$Year, gapmind$life, use = 'pairwise')
```

There is a strong correlation of 0.78 between year and life which is evidence that these two are correalated. We can observe from the graph that as the time progresses, the life expectancy becomes higher. This is very much true for Sub Saharan Africa. 

***

# Final Plots and Summary

In the above analysis I tried to analyze the GapMinder data set in an exploratory manner. I tried ot pick the graphs that would give us the best representation of the data whiel avoiding unnecessary clutter. As an intial step,I looked at the the variables separtely to see the trend within. Quantitative summary as well as a distrubutive summary was obtained for all the variables. We were also able to group variables to get more contextual picture of the dataset. One striking colcusion was the eventhough ther is a .78 correlatoin between  


```{r,echo=FALSE,warning=FALSE}
#adding ratio of residual.sugar/chlorides to gapmind dataframe
ggplot(aes(x =residual.sugar, y = chlorides, color = factor(quality)), 
       data = gapmind_quant) +
      geom_point(alpha = 0.8, size = 1) +
      geom_smooth(method = "lm", se = FALSE,size=1)  +
  scale_color_brewer(type='seq', guide=guide_legend(title='Quality'))
```

I include this plot because this was our first strong evident for alcohol quality. We can see as before that the lower the chloride content, the better alcohol. Furthermore, low alcohol levels seems to have less sugar and high chloride content

This plot spurred my interest in exploring the relationship of chlorides and acids.


```{r, echo=FALSE, warning=FALSE}
sugar.chlorides+
  geom_jitter(aes(color=citric.acid), size = 0.5) +
  scale_colour_gradient2(low="red", high="blue", midpoint=0.25) +
  ggtitle('Chlorides, residual sugar & citric acid facetted by quality')
```

citric acid and white wine quality are very less related. At the later part of analysis we confirmed this by plotting boxplot of citric acid that it does not play so significant role here to enhance white wine quality.

```{r,echo=FALSE,warning=FALSE}
ggplot(aes(x = quality.lvl, y = chlorides), data = gapmind) +
  geom_jitter(alpha = 0.2, color = 'orange') +
  geom_boxplot(outlier.colour = 'red', alpha = 0.3) +
  stat_summary(fun.y = "mean", geom = "point", color = "blue", shape = 8, size = 4) +
  coord_cartesian() +
  ylim(quantile(gapmind$chlorides,0.05),quantile(gapmind$chlorides,0.95)) +
  ggtitle("Chlorides by quality, red outliers")
```

The overall downward trend here with strong correlation, tells us that less salt in wine better quality.

## Conclusion
 
In this project my main focus was to do only exploratory analysis.

1. I started the analysis by looking at the data overal. Some data points seemed really far out and during the analysis, I removed some of them. But I decided to keep them in the end as wine tastes can vary greatly.  
Looking at the different variables, I decidied to investigate what made a wine good.
2. I  started by looking at the main things that could affect taste: alcohol, chlorides, residual.sugar and  pH. My first finding was really about alcohol and quality.  
3. I then moved to multivariables analyses by combining alcohol with chlorides and residual.sugar. The overall trends by quality looked quite similar so I tried to plot chlorides with residual.sugar. But the results was not what I was expecting. Thinking that another factor might be related with those two, I went through the the acidity variables and the quality to select volatile.acidity and citric.acidity and plot them with chlorides and residual.sugar.

I did the same exercice for the rest of the variables. I was looking for some more adavanced relations between the variables but was not able to find them. I am
I get all in all several variables correlating with quality:
1. Alcohol
2. Volatile acidity
3. Citric acid
4. Sulphates


_The limits of the dataset are really the lack of points on the lower and higher quality wines. Futhermore, the source of the quality is unknown, is it from a professionnal? A store? And we have to keep in mind that taste is a really cultural thing (see the [indian food analysis](http://www.washingtonpost.com/blogs/wonkblog/wp/2015/03/03/
a-scientific-explanation-of-what-makes-indian-food-so-delicious/)) and a good wine for someone might not be for another._


_Last but not least, we do not have the age of the wine. In France, one of the first thing we check for a wine is its age because common knowledge dictates that an older wine is bet Another thing that I would like is to get the name of the wines so that I can get their prices and see if how they relate to quality._
